<h1>YawsPi - Yet Another Watering System for raspberry PI</h1>

<h2>General description</h2>

<p>System developed for automatic watering of plants.</p>

<h2>Why not use automatic timed water dispensers?</h2>

<p>Every plant needs different rate of watering and soil humidity, e.g. Cyperus needs a lot of water,
the swamp is ideal. Contrary Zamioculcas likes small amount of water in shady places, and dry soil.
Simple drop waterer or water dispenser can not do this. One can solve some problems by self watering
pots, but they have mostly limited water volume.</p>

<h2>Why not one of similar projects?</h2>

<p>Similar projects (other exists):
<a href="http://www.parrot.com/usa/products/flower-power/">Parrot Flower Power</a>,
<a href="https://www.edyn.com/">Edyn</a>,
<a href="http://rayshobby.net/opensprinkler/">OpenSprinkler</a>.</p>

<p>These projects are either expensive (the project was aimed in the beginning for 14 power pots, every
one with different plant), or not suitable to my needs. Probably there exists at least one suitable
and cheap enough project in the world, but I couldn't find it in 2013 and it was fun to develop it.
And... it is not finished, never will be, so I have something to do till my end of life.</p>

<h2>Price budget</h2>

<ul>
<li>Raspberry Pi: ~37 euro</li>
<li>Valves: 14*5.5 = 78 euro</li>
<li>Pump: 17 euro</li>
<li>Power source: ~33 euro</li>
<li>PCBs: ~75 euro</li>
<li>Sensors etc: ~75 euro</li>
<li>Total: something about 315 euro</li>
</ul>

<p>Compare this to the OpenSprinkler (145 euro for DIY version and zone expander), which can not water
pot by soil humidity. Anyway I owe a lot of inspiration and learned code to the OpenSprinkler and
OpenSprinklerPi.</p>

<h2>System description</h2>

<p>The watering system is built in such way that: there is one water source (e.g. barrel of water, or
water tap). A pump is used to pump water from water source. Water is leaded by tubes into several
valves. From valves water is leaded to the plant pots. Control software always open only one valve,
so it can direct water from water source to the desired plant pots. Every plant pot and water source
can have one water level sensor of different types.</p>

<p><img src="./images/block-scheme.png" alt="blockscheme" title="" /></p>

<p>System can be set to water plants in plant pots in three different ways:
1, watering based on water level or soil humidity of the plant pot,
2, watering based on the day of the week and hour of the day and on the water level or soil humidity of the pot,
3, watering every Nth day and hour and on the water level or soil humidity of the pot.</p>

<p>The system logs watering and weather, so hopefully I will be able to relate temperature/humidity to
the water consumption of particular plants. The plan is also to increase or decrease frequency of
watering depending on the temperature/humidity/rain for the second and third mode of watering.</p>

<p>System consists of:</p>

<ol>
<li>Hardware with components:
<ol>
<li>controlling computer Raspberry Pi,</li>
<li>power supply,</li>
<li>water pump,</li>
<li>water valves,</li>
<li>water level sensors (optional),</li>
<li>weather sensors (optional),</li>
<li>water tubes.</li>
<li>YawsPi electronics,</li>
</ol></li>
<li>Software with components:
<ol>
<li>Hardware modules,</li>
<li>hardware configuration,</li>
<li>hardware abstraction layer,</li>
<li>main program running in two threads, one is for watering, second one is for web server.</li>
</ol></li>
</ol>

<h2>Detailed description of hardware</h2>

<h3>Raspberry Pi</h3>

<p>System was built up on Raspberry Pi, but any other with general purpose input/output ports and able to run python can be used.</p>

<h3>Power supply</h3>

<p>Raspberry Pi requires 5 V, water pump requires 6-9 V, water valves requires 24 V. Switching power
supply Mean Well RQ-85D was selected. It has got one 5 V, 6 A output, one 12 V 2 A output, one 24 V 1 A
output and one -12 V 0.5 A output.
<a href="./datasheets/power_source_Mean_Well_RQ-85D.pdf">Datasheet</a>.</p>

<p>You can buy one in shops with electronics, like <a href="http://www.gme.cz">http://www.gme.cz</a> or <a href="http://www.farnell.com">http://www.farnell.com</a>.</p>

<p><img src="./images/power_source_Mean_Well_RQ-85D.jpg" alt="RQ-85D" title="" /></p>

<h3>Water pump</h3>

<p>Immersible Barwig BW04 water pump was used. It can pump up to 10 l/min. For continuous usage needs 
6 to 9 V power source. It was immersed directly into the barrel - water source.
<a href="./datasheets/water_pump_Barwig_BW04.pdf">Datasheet</a>.</p>

<p>You can buy it e.g. at <a href="http://www.conrad.cz">http://www.conrad.cz</a>.</p>

<p><img src="./images/water_pump_Barwig_BW04.jpg" alt="BW-04" title="" /></p>

<h3>Water valves</h3>

<p>The cheapest water valve I was able to find was VIVA Sanela VE-RPE4115NC. It is monostable DC coil
powered by 24 V, normally closed, i.e. without any power it is closed. That was the safety
requirement - if the power goes wrong, water is stopped. It is used in water plumbing, so you can
buy such valve in several shops, like: <a href="http://www.sanela.cz/">http://www.sanela.cz/</a>.</p>

<p><img src="./images/water_valve_VIVA_Sanela_VE-RPE4115NC.jpg" alt="VE-RPE4115NC" title="" /></p>

<h3>water level sensors</h3>

<p>XXX popis sensoru do softwaru XXX
For now I have implemented following water level sensors:</p>

<ol>
<li>none</li>
<li>min</li>
<li>max</li>
<li>minmax</li>
<li>grad</li>
</ol>

<p>For min, max and minmax sensors I used these two:
XXX
For grad sensor I tested:
XXX</p>

<h4>none</h4>

<p>No water level sensor. Software always detects the water pot is empty. Amount of water needed to
water the pot is determined by the water capacity of the water pot.</p>

<h4>min</h4>

<p>Sensor changes state when water level reaches the bottom of the water pot. Sensor detects water pot
is empty. Amount of water needed to water the pot is determined by the water capacity of the water
pot.</p>

<h4>max</h4>

<p>Sensor changes state when water level reaches the top of the water pot. Sensor detects water pot is
full. Amount of water needed to water the pot is determined by the sensor.</p>

<h4>minmax</h4>

<p>Sensor changes state when water level reaches the top or the bottom of the water pot. Sensor detects
water pot is full, empty or in between. Amount of water needed to water the pot is determined by the
sensor.</p>

<h4>grad</h4>

<p>Analog sensor. Sensor directly detects the water level. Amount of water needed to water the pot is
determined by the sensor.</p>

<h3>weather sensors</h3>

<p>Following weather sensors are implemented:</p>

<ol>
<li>Air temperature</li>
<li>Air humidity</li>
<li>Air pressure</li>
<li>Ambient illuminance</li>
<li>Rain status</li>
</ol>

<h4>air temperature</h4>

<p>The ambient temperature can be measured either by DHT11 sensor (used for air humidity) or BMP180
sensor (used for air pressure).</p>

<h4>air humidity</h4>

<p>The humidity is measured by DHT11 sensor, I used terrible but cheap module from Keyes. I had to remove
the original capacitor from module and original resistor replace by a 9.9 kOhm resistor. 
<a href="./datasheets/humidity_sensor_Keyes_DHT11.pdf">Datasheet</a>.</p>

<p>I bought it here:
<a href="http://www.dx.com/p/keyes-dht11-fr4-temperature-humidity-sensor-module-for-arduino-red-blue-300280">http://www.dx.com/p/keyes-dht11-fr4-temperature-humidity-sensor-module-for-arduino-red-blue-300280</a></p>

<p><img src="./images/humidity_sensor_Keyes_DHT11.jpg" alt="Keyes DHT11" title="" /></p>

<h4>air pressure</h4>

<p>The pressure is measured by BMP180 sensor.
<a href="./datasheets/BST-BMP180-DS000-08.pdf">BMP 180 Datasheet</a>.</p>

<p>I bought this module:
<a href="http://www.dx.com/p/bmp180-bosch-temperature-air-pressure-module-deep-blue-294251">http://www.dx.com/p/bmp180-bosch-temperature-air-pressure-module-deep-blue-294251</a></p>

<p><img src="./images/pressure_sensor_BMP180.jpg" alt="BMP180" title="" /></p>

<h4>ambient illuminance</h4>

<p>The light intensity is measured by BH1750FVI sensor.
<a href="./datasheets/bh1750fvi-e.pdf">BH1750FVI Datasheet</a>.</p>

<p>I bought this module:
<a href="http://www.dx.com/p/bh1750fvi-digital-light-intensity-sensor-module-blue-182595">http://www.dx.com/p/bh1750fvi-digital-light-intensity-sensor-module-blue-182595</a></p>

<p><img src="./images/illuminance_sensor_BH1750FVI.jpg" alt="BH1750FVI" title="" /></p>

<h4>rain status</h4>

<p>The rain status is measured by module from Octopuss. Essentially it is grad type water level sensor. I bought it here:
<a href="http://www.dx.com/p/octopus-rain-steam-sensor-module-w-cable-white-silver-192829">http://www.dx.com/p/octopus-rain-steam-sensor-module-w-cable-white-silver-192829</a></p>

<p>It is connected to AD converter.</p>

<p><img src="./images/rain_sensor_Octopus.jpg" alt="BH1750FVI" title="" /></p>

<h3>water tubes</h3>

<p>I bought polyethylene tubes, joints etc. to connect pump, valves and pots here: 
<a href="http://www.instarjbc.cz">http://www.instarjbc.cz</a>
and here:
<a href="http://www.koupelnyeshop.cz/">http://www.koupelnyeshop.cz/</a>
.</p>

<p><img src="./images/tubing_cross.jpg" alt="" title="" />
<img src="./images/tubing_joint.jpg" alt="" title="" />
<img src="./images/tubing_joint_2.jpg" alt="" title="" />
<img src="./images/tubing_joint_3.jpg" alt="" title="" /></p>

<p>Valve with connections for polyethylene tube:</p>

<p><img src="./images/valve_tubing.jpg" alt="" title="" /></p>

<h3>RTC</h3>

<p>Real time clock module keeps time in the case of boot up without internet. It is based on the chip PCF8563.
<a href="./datasheets/PCF8563_SCH.pdf">Module Datasheet</a>,
<a href="./datasheets/PCF8563.pdf">PCF8563 Datasheet</a>.</p>

<p>I bought it here: 
<a href="http://www.dx.com/p/pcf8563-rtc-board-for-raspberry-pi-real-time-clock-module-blue-281614">http://www.dx.com/p/pcf8563-rtc-board-for-raspberry-pi-real-time-clock-module-blue-281614</a></p>

<p><img src="./images/RTC.jpg" alt="" title="" /></p>

<h3>YawsPi electronics</h3>

<p>This is electronics to interface power source, water pump, water level and weather sensors to the
Raspberry Pi. Generally it transform voltage levels and connects sensors, analogue to digital
converters and port expander to the Raspberry Pi.</p>

<p>Main board contains connector to Raspberry Pi, connectors for weather sensors (all but rain sensor),
RTC, voltage stabilizer to generate water pump voltage, bidirectional voltage converter and one way
voltage converter. Raspberry Pi works with 3.3 V logic level. To convert logic to 5 V, bidirectional
level converter XXX is used for I2C bus. It can convert only four wires, therefore for the rest a
voltage converter with 74LVC8T245 chip was used.</p>

<p><img src="./images/pcb_main_small.jpg" alt="" title="" /></p>

<p>The secondary board contains two port expanders MCP23017, one AD converters MCP3008 for mesurement
of grad sensors value, and two transistor arrays ULN2003A. One array is connected to 24 V and
switches valves. Second one is connected to 5 V and switches grad sensors (why it is needed see grad
sensors hardware). Secondary board also contain a relay to switch water pump. It electrically
isolated by relay because the water pump is always immersed in water.</p>

<p><img src="./images/pcb_sec_small.jpg" alt="" title="" /></p>

<p>Multiple secondary boards can be connected. One have to ensure all I2C addresses of port expanders
and sensors and SPI cable select wires are different on all boards.</p>

<h4>Bidirectional level converter</h4>

<p>XXX</p>

<h4>one way level converter</h4>

<p>XXX</p>

<h4>Port Expander</h4>

<p>MCP23017 has 16 I/O ports and is controlled by I2C bus.
<a href="./datasheets/MCP23017.pdf">Datasheet</a>.</p>

<h4>ADC</h4>

<p>MCP3008 is 10-bit 8 channel AD converter and is controlled by SPI bus.
<a href="./datasheets/MCP3008.pdf">Datasheet</a>.</p>

<h4>Transistor array</h4>

<p>ULN2003A has 7 darlington transistors. It is controlled directly by TTL signal. It is used for
switching water valves and power to the grad sensors. (It would be probably better to use TD62783
chip, maybe in next revision...)
<a href="./datasheets/uln2003a.pdf">Datasheet</a>.</p>

<h2>Detailed description of software</h2>

<h3>hardware modules</h3>

<h3>hardware configuration</h3>

<h3>hardware abstraction layer</h3>

<h3>main program</h3>
